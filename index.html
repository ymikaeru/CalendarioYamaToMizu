<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calend√°rio de Poesias - Yama to Mizu</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Noto+Serif+JP:wght@300;400&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f8f8f8;
            /* Branco gelo ainda mais limpo */
            color: #1a1a1a;
            min-height: 100vh;
            padding: 80px 24px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* CONTROLES */
        .controls-card {
            background: #fff;
            border: 1px solid #eee;
            padding: 40px;
            margin-bottom: 60px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
        }

        .controls-title {
            font-size: 13px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            text-align: center;
            margin-bottom: 40px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .control-group label {
            font-size: 11px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
            display: block;
        }

        .control-group select,
        .control-group input,
        .btn {
            height: 48px;
            width: 100%;
            padding: 0 16px;
            border: 1px solid #e5e5e5;
            background: #fff;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            color: #1a1a1a;
            border-radius: 0;
            /* Quadrado n√≥rdico */
            transition: all 0.2s;
            appearance: none;
        }

        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
            font-size: 12px;
            gap: 8px;
        }

        .btn-primary {
            background: #111;
            color: #fff;
            border-color: #111;
        }

        .btn-primary:hover {
            background: #333;
        }

        .btn-secondary {
            background: #fff;
            color: #111;
            border: 1px solid #e5e5e5;
        }

        .btn-secondary:hover {
            border-color: #111;
        }

        .button-row {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        /* CALEND√ÅRIO */
        #calendario {
            background: #fff;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.03);
            /* Sombra suave de eleva√ß√£o */
        }

        .hero-section {
            background: #fff;
            padding: 100px 60px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
        }

        .poesia-original {
            font-family: 'Noto Serif JP', serif;
            font-size: 42px;
            font-weight: 300;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #111;
        }

        .poesia-traducao {
            font-size: 16px;
            font-weight: 300;
            color: #666;
            line-height: 1.8;
            max-width: 700px;
            margin: 0 auto;
            font-style: italic;
        }

        .calendar-section {
            padding: 60px 80px;
            background: #fff;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 40px;
            border-bottom: 2px solid #111;
            /* Linha de impacto */
            padding-bottom: 20px;
        }

        .month-title {
            font-size: 48px;
            /* T√≠tulo bem grande */
            font-weight: 700;
            letter-spacing: -0.03em;
            color: #111;
            line-height: 1;
        }

        .moon-phases {
            text-align: right;
        }

        .moon-phases-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #999;
            margin-bottom: 6px;
        }

        .moon-phases-row {
            display: flex;
            gap: 12px;
            font-size: 13px;
            color: #555;
            font-family: 'Inter', sans-serif;
        }

        /* GRID */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            width: 100%;
        }

        .day-header {
            padding: 16px 0;
            text-align: left;
            /* Alinhamento √† esquerda moderno */
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-bottom: 1px solid #e5e5e5;
            color: #999;
        }

        .day-cell {
            min-height: 140px;
            /* C√©lulas bem altas */
            padding: 16px 0;
            /* Sem padding lateral */
            border-bottom: 1px solid #f0f0f0;
            position: relative;
        }

        /* REMOVENDO BORDAS VERTICAIS PARA VISUAL CLEAN */
        .day-cell {
            border-right: none !important;
        }

        .day-header {
            border-right: none !important;
        }

        .day-number {
            font-size: 24px;
            /* N√∫meros grandes */
            font-weight: 300;
            margin-bottom: 8px;
        }

        .day-number.sunday {
            color: #dc2626 !important;
        }

        .day-number.saturday {
            color: #2563eb !important;
        }

        .day-number.holiday {
            color: #dc2626 !important;
            font-weight: 500;
        }

        .holiday-name {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            color: #dc2626;
            margin-top: 4px;
            letter-spacing: 0.05em;
        }

        .other-month .day-number {
            color: #eee !important;
        }

        .year-footer {
            margin-top: 40px;
            text-align: right;
            font-size: 80px;
            font-weight: 800;
            color: #f0f0f0;
            /* Ano gigante e sutil no fundo */
            line-height: 0.8;
            letter-spacing: -0.05em;
        }

        /* CARD */
        .card-miniatura {
            background: #fff;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid #eee;
        }

        .card-miniatura:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.08);
            border-color: #111;
        }

        .grid-ano {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
        }

        /* Media Queries */
        @media (max-width: 1024px) {
            .grid-ano {
                grid-template-columns: repeat(2, 1fr);
            }

            .calendar-section {
                padding: 40px;
            }

            .day-number {
                font-size: 20px;
            }

            .day-cell {
                min-height: 100px;
            }
        }

        @media (max-width: 600px) {
            .grid-ano {
                grid-template-columns: 1fr;
            }

            .month-title {
                font-size: 32px;
            }

            .hero-section {
                padding: 60px 24px;
            }

            .calendar-section {
                padding: 30px 20px;
            }

            .day-header {
                text-align: center;
            }

            /* Mobile centralizado */
            .day-number {
                text-align: center;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .controls-card,
            .btn {
                display: none;
            }

            #calendario {
                box-shadow: none;
            }

            .month-title {
                font-size: 60px;
            }

            /* Gigante na impress√£o */
            .day-cell {
                border-bottom: 1px solid #ccc;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Controles -->
        <div class="controls-card">
            <h1 class="controls-title">
                üìÖ Gerador de Calend√°rio
            </h1>

            <!-- Controles -->
            <div class="controls-grid">
                <div class="control-group">
                    <label>M√™s</label>
                    <select id="mesSelect" onchange="atualizarCalendario()">
                        <option value="0">Janeiro</option>
                        <option value="1">Fevereiro</option>
                        <option value="2">Mar√ßo</option>
                        <option value="3">Abril</option>
                        <option value="4">Maio</option>
                        <option value="5">Junho</option>
                        <option value="6">Julho</option>
                        <option value="7">Agosto</option>
                        <option value="8">Setembro</option>
                        <option value="9">Outubro</option>
                        <option value="10">Novembro</option>
                        <option value="11">Dezembro</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>Ano</label>
                    <input type="number" id="anoInput" onchange="atualizarCalendario()">
                </div>

                <div class="control-group">
                    <label>Tamanho do Papel</label>
                    <select id="tamanhoPapel">
                        <option value="A3">A3 (297 √ó 420 mm)</option>
                        <option value="A4">A4 (210 √ó 297 mm)</option>
                    </select>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button onclick="randomizarPoesia()" class="btn btn-primary"
                        style="width: 100%; justify-content: center;">
                        üé≤ Randomizar M√™s
                    </button>
                </div>

                <div class="control-group">
                    <label>&nbsp;</label>
                    <button onclick="randomizarAnoCompleto()" class="btn btn-primary"
                        style="width: 100%; justify-content: center;">
                        üé≤ Randomizar Ano Completo
                    </button>
                </div>
            </div>

            <div class="button-row">
                <button class="btn btn-secondary" onclick="alternarVisao()">
                    üëÅÔ∏è Ver Grade Anual
                </button>
                <button class="btn btn-dark" onclick="imprimirMes()">
                    üñ®Ô∏è Imprimir M√™s
                </button>
                <button class="btn btn-primary" onclick="imprimirAnoCompleto()">
                    üìÖ Imprimir Ano Completo (12 meses)
                </button>
            </div>
        </div>

        <!-- Vis√£o √önica (Padr√£o) -->
        <div id="calendario">
            <!-- Conte√∫do do calend√°rio gerado via JS -->
        </div>

        <!-- Vis√£o Grade Anual (Oculta) -->
        <div id="visaoAno" class="grid-ano" style="display: none;">
            <!-- Grid gerado via JS -->
        </div>
    </div>

    <script>
        // Estado global
        let state = {
            mes: new Date().getMonth(),
            ano: new Date().getFullYear(),
            poesiaSelecionada: 0,
            temaFiltro: 'Todos',
            poesiasEscolhidas: Array(12).fill(null), // Array para guardar √≠ndice da poesia de cada m√™s (0-11)
            todasPoesias: [
                // JANEIRO - Ver√£o
                {
                    title: "Pirilampos",
                    original: "Â§ï„Åï„Çä„Å¶„ÄÄÈùíÁî∞„ÇíÊ∏°„ÇãÈ¢®Ê∂º„Åó„ÄÄË°åÊâã„ÅÆÈóá„ÇíËõç„Åã„Åô„ÇÅ„Å¨",
                    translation: "Ao cair da tarde, O vento que cruza os arrozais verdes traz frescor; Pirilampos riscam a escurid√£o do meu caminho.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Verde Vibrante",
                    original: "ÈùíÈùí„Å®„ÄÄËåÇ„ÇäÂêà„ÅÜÊú®„ÅÆËëâÂΩ±„Å´„ÄÄÊ∂º„Åó„ÅçÈ¢®„ÅÆÊôÇ„ÄÖÂêπ„Åë„Çã",
                    translation: "Azul-verde vibrante! √Ä sombra das folhas que se entrela√ßam densamente, Uma brisa fresca sopra de tempos em tempos.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Arrozais Verdes",
                    original: "ÈùíÈùíÁî∞Âéü„ÄÄÊ∏°„ÇãÈ¢®„Åì„ÅùÂøÉÂú∞„Çà„Åë„Çå„ÄÄÈ†¨„Å´ÂΩì„Åü„Çä„Å¶Ê±ó„ÅÆ‰πæ„Åè„Çí",
                    translation: "O vento que cruza os arrozais verdejantes √â t√£o agrad√°vel! Toca meu rosto E seca o suor que escorre.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Vento Perfumado",
                    original: "È¢®Ëñ´„Çã„ÄÄÊúù„ÅÆ„Åô„Åö„Çç„Å´ÂøÉÂú∞„Çà„Åç„ÄÄÈà¥Ëô´„ÅÆÈü≥„ÇíËÅû„Åç„Å§„Å§Ê≠©„ÇÄ",
                    translation: "O vento perfumado da manh√£ traz uma sensa√ß√£o deliciosa! Caminho ouvindo O som dos grilos cantando.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Sombra do Bambu",
                    original: "Á´πÊûó„ÅÆ„ÄÄ‰∏ãÈô∞Ê∂º„ÅóÂ§è„ÅÆÊó•„ÅÆ„ÄÄÊöë„Åï„ÇíÂøò„Çå„Åó„Å∞„Åó„Åü„Åü„Åö„ÇÄ",
                    translation: "Fresca √© a sombra sob os bambus! Em um dia de ver√£o, Esque√ßo o calor E fico parado por um momento.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },

                // FEVEREIRO - Ver√£o
                {
                    title: "Expans√£o da Alma",
                    original: "È¢®Ëñ´„Çä„ÄÄÈùíËëâÂÖâ„Çå„ÇãÂàùÂ§è„ÅÆ„ÄÄÂ∫≠„Å´‰∏ã„Çä„Åü„Å¶„Å∞ËÉ∏„ÅÆ„Å≤„Çç„Åé„Å¨",
                    translation: "O vento perfumado e as folhas verdes resplandecem; Ao descer ao jardim no in√≠cio do ver√£o, Meu peito se dilata infinitamente.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Luz nas Folhas",
                    original: "Êú®„ÅÆËëâÂΩ±„ÄÄ„ÅØ„Å†„Çâ„Å´ÂÖâ„ÇãÂ§è„ÅÆÊó•„ÅÆ„ÄÄÊöë„Åï„ÇÇÂøò„Çå„Åó„Å∞„Åó„Åü„Åü„Åö„ÇÄ",
                    translation: "Atrav√©s da sombra das folhas, A luz do sol cintila salpicada... Esque√ßo at√© o calor do ver√£o E fico parado, contemplando.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Juncos Crescendo",
                    original: "Ëã•Ëë¶„ÅÆ„ÄÄ„Åô„Åè„Åô„Åè‰º∏„Å≥„ÇãÂ§è„ÅÆÈáé„ÅÆ„ÄÄÂäõÂº∑„Åï„ÇíË¶ã„Çã„Åì„ÅùÂ¨â„Åó",
                    translation: "Os juncos jovens crescem vigorosos nos campos de ver√£o... Que alegria ver Essa for√ßa poderosa!",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Verde Intenso",
                    original: "ÈùíËëâËã•Ëëâ„ÄÄÂÖâ„ÇäËºù„ÅèÂ§è„ÅÆÊúù„ÄÄÂøÉ„ÇÇÊô¥„Çå„Å¶Ê∞óÂàÜÁàΩ„ÇÑ„Åã",
                    translation: "Folhas verdes, folhas novas Brilham radiantes na manh√£ de ver√£o... Meu cora√ß√£o se abre E meu esp√≠rito se torna fresco.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Rio Azul",
                    original: "ÈùíÈùí„Å®„ÄÄÊæÑ„ÇÅ„ÇãÂ∑ùÈù¢„Å´ÈÆéË∑≥„Å≠„Å¶„ÄÄÂ§è„ÅÆ„ÅÑ„ÅÆ„Å°„ÅÆËºù„ÅçË¶ã„Åõ„Å¨",
                    translation: "Azul profundo e l√≠mpido √© o rio... Os peixes saltam na superf√≠cie, Mostrando o brilho Da vida no ver√£o.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },

                // MAR√áO - Outono
                {
                    title: "O Arco-√çris de Maio",
                    original: "‰∫îÊúàÈõ®„ÅÆ„ÄÄÈúΩ„Çã„Çã„Å®Ë¶ã„Çå„Å∞ÈÅ†Êñπ„Å´„ÄÄÈõ≤„ÅÆÂ≥Ø‰∏¶„Åø„ÅÜ„Åô„ÇâËôπË¶ã„ÇÜ",
                    translation: "Ao dissipar-se a longa chuva de maio, Vislumbro ao longe picos de nuvens E um t√™nue arco-√≠ris a surgir.",
                    kigo: "Outono",
                    meses: [5]
                },
                {
                    title: "C√©u Transparente",
                    original: "ÁßãÊô¥„Çå„ÅÆ„ÄÄÁ©∫„ÅÆÊ∏Ö„Åë„ÅïË®ÄËëâ„Å™„Åó„ÄÄ„Åü„Å†Ë¶ã‰∏ä„Åí„Å§„Å§ÂøÉÊ¥ó„Çè„Çã",
                    translation: "N√£o h√° palavras para descrever A pureza do c√©u claro de outono... Apenas olho para cima E meu cora√ß√£o √© lavado.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Ar Cristalino",
                    original: "Áßã„ÅÆÁ©∫„ÄÄÊæÑ„ÇÅ„Çã„ÅåÂ¶Ç„ÅèÂøÉ„Åæ„Åß„ÄÄÊ∏Ö„ÇÅ„Çâ„Çå„ÇÜ„ÅèÊÄù„ÅÑ„Åô„Çã„Åã„Å™",
                    translation: "Como o c√©u l√≠mpido do outono, Sinto que at√© meu cora√ß√£o Est√° sendo purificado.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Folhas Coloridas",
                    original: "„ÇÇ„Åø„ÅòËëâ„ÅÆ„ÄÄËâ≤„Å•„ÅçÂàù„ÇÄ„ÇãÁßã„ÅÆÂ±±„ÄÄË¶ã„Çã„ÇÇÊ•Ω„Åó„Åç‰ªäÊó•„Åì„ÅÆÈ†É„Åã„Å™",
                    translation: "As folhas de bordo come√ßam a se colorir Na montanha de outono... Que prazer contempl√°-las Nestes dias!",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Brisa Outonal",
                    original: "ÁßãÈ¢®„ÅÆ„ÄÄÊ∂º„Åó„ÅèÂêπ„Åç„Å¶ÂøÉÂú∞„Çà„Åó„ÄÄÊöë„ÅïÂéª„Çä„Åü„ÇãÂπ∏„ÇíÊÄù„ÅÑ„Å¨",
                    translation: "A brisa de outono sopra fresca e agrad√°vel... Penso na felicidade De o calor ter passado.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },

                // ABRIL - Outono  
                {
                    title: "O Tempo da D√°lia",
                    original: "„ÉÄ„Éº„É™„É§„ÅÆ„ÄÄËä±„ÅÆ„ÅÑ„Çç„ÅÑ„ÇçÁßã„ÅÆÈôΩ„Å´„ÄÄ„ÇÇ„Åà„Åü„Å§„ÇíË¶ã„Å¨„Çè„ÅåÊöá„Å≤„Åæ„Çí",
                    translation: "As v√°rias cores das D√°lias ardem como fogo ao sol de outono... E eu aproveito meus momentos de folga para contemplar esse inc√™ndio.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Sol de Outono",
                    original: "Áßã„ÅÆÈôΩ„ÅÆ„ÄÄÂÑ™„Åó„ÅèÁÖß„Çâ„ÅôÂçàÂæå„ÅÆÂ∫≠„ÄÄÈùô„Åë„Åï„ÅÆ‰∏≠„Å´ÂøÉÂÆâ„Çâ„Åê",
                    translation: "O sol de outono ilumina gentilmente O jardim da tarde... No sil√™ncio, Meu cora√ß√£o encontra paz.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Montanha Distante",
                    original: "ÁßãÊô¥„Çå„Å´„ÄÄÈÅ†„ÅçÂ±±Ë¶ã„ÅàÂøÉÂú∞„Çà„Åó„ÄÄÁ©∫Ê∞óÊæÑ„Åø„Åü„Çã‰ªäÊó•„Åì„ÅÆÈ†É„Çí",
                    translation: "No c√©u claro de outono, vejo montanhas dist antes... Que sensa√ß√£o agrad√°vel! Nestes dias de ar puro.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Lib√©lulas Dan√ßando",
                    original: "ÁßãÁ©∫„Å´„ÄÄÁæ§„Çå„Å¶È£õ„Å≥‰∫§„ÅÜËµ§„Å®„Çì„Åº„ÄÄÂ§ïÊó•„ÇíÊµ¥„Å≥„Å¶Ëºù„ÅçË¶ã„Åõ„Å¨",
                    translation: "No c√©u de outono, lib√©lulas vermelhas voam em bando... Banhadas pelo sol poente, Mostram seu brilho.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Noite Fresca",
                    original: "Áßã„ÅÆÂ§ú„ÅÆ„ÄÄÊ∂º„Åó„ÅçÈ¢®„Å´Ë™ò„Çè„Çå„Å¶„ÄÄÁ™ì„ÇíÈñã„Åë„Å∞Êòü„ÅÆËºù„Åç",
                    translation: "Convidado pela brisa fresca da noite de outono, Abro a janela E vejo o brilho das estrelas.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },

                // MAIO - Outono
                {
                    title: "Vidros Cintilantes",
                    original: "„ÅÜ„Çâ„Çâ„Åã„Å´„ÄÄÈôΩ„Åñ„ÅôÊúù„Å™„ÇäÁßã„ÅÆÁ©∫„ÄÄ„Åô„Åë„ÇãÁéªÁíÉÊà∏„ÅØ„Åø„Å™„Åç„Çâ„ÇÅ„Åë„Çã",
                    translation: "Radiante e serena √© a manh√£, banhada de sol sob o c√©u de outono... As portas de vidro, perfeitamente transl√∫cidas, Cintilam todas, em um espet√°culo de pura luz.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Claridade Matinal",
                    original: "Áßã„ÅÆÊúù„ÄÄÁ™ì„Çà„ÇäÂ∑Æ„ÅóËæº„ÇÄÂÖâË¶ã„Å¶„ÄÄ‰∏ÄÊó•„ÅÆÂßã„Åæ„ÇäÂøÉË∫ç„Çâ„Åô",
                    translation: "Manh√£ de outono... Vejo a luz entrando pela janela E meu cora√ß√£o salta Com o in√≠cio do dia.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Grama Outonal",
                    original: "ÁßãËçâ„ÅÆ„ÄÄÈú≤„Å´Êø°„Çå„Åü„ÇãÊúù„ÅÆÂ∫≠„ÄÄÈùôÂØÇ„ÅÆ‰∏≠„Å´Áæé„Åó„ÅïÂÆø„Çã",
                    translation: "As ervas de outono molhadas de orvalho No jardim da manh√£... No sil√™ncio Habita a beleza.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Paz do Entardecer",
                    original: "Áßã„ÅÆÊó•„ÅÆ„ÄÄÂ§ï„ÅπÈùô„Åã„Å´ÊöÆ„Çå„ÇÜ„Åç„Å¶„ÄÄÂøÉ„ÅÆÂÜÖ„ÇÇÁ©è„ÇÑ„Åã„Å´„Å™„Çã",
                    translation: "O dia de outono vai silenciosamente escurecendo... E dentro do meu cora√ß√£o Tamb√©m se faz a calma.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },
                {
                    title: "Lua Clara",
                    original: "Áßã„ÅÆÊúà„ÄÄÂÜ¥„ÅàÂÜ¥„Åà„Å®ÁÖß„ÇãÂ§ú„ÅÆÁ©∫„ÄÄÁú∫„ÇÅ„Å¶ÂøÉÊ∏Ö„ÇÅ„Çâ„Çå„ÇÜ„Åè",
                    translation: "A lua de outono brilha l√≠mpida e clara No c√©u noturno... Contemplando-a, Meu cora√ß√£o √© purificado.",
                    kigo: "Outono",
                    meses: [3, 4, 5]
                },

                // JUNHO - Inverno
                {
                    title: "O Som da Geada",
                    original: "Ê©ã„ÅÆ‰∏ä„ÅÆ„ÄÄÂ§úÈúú„Åï„Çâ„Åï„ÇâÈü≥„Åô„Å™„Çä„ÄÄÂØíÊúàÁ©∫„Å´„Å§„ÇÅ„Åü„ÅèÂÖâ„Çã",
                    translation: "Sobre o tabuleiro da ponte, a geada noturna ro√ßa e sussurra ‚Äî 'sara-sara'... Enquanto no alto, a Lua Fria cintila, G√©lida e cortante na vastid√£o do firmamento.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Manh√£ Gelada",
                    original: "ÂÜ¨„ÅÆÊúù„ÄÄÁ™ì„ÅÆÂ§ñ„Å´„ÅØÈúúÈôç„Çä„Å¶„ÄÄÁôΩ„Åç‰∏ñÁïå„ÅÆÁæé„Åó„Åç„Åã„Å™",
                    translation: "Manh√£ de inverno... Fora da janela a geada caiu, Criando um mundo branco De grande beleza.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Ar Frio",
                    original: "ÂØí„ÅçÊúù„ÄÄÊÅØÁôΩ„ÅèÂá∫„Å¶ÂÜ¨„ÇíÁü•„Çã„ÄÄË∫´„ÇíÂºï„ÅçÁ∑†„ÇÅ„Å¶Ê≠©„ÅøÂßã„ÇÅ„Çã",
                    translation: "Manh√£ fria... Minha respira√ß√£o sai branca e sei que √© inverno. Armando-me de coragem, Come√ßo a caminhar.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "C√©u de Inverno",
                    original: "ÂÜ¨Á©∫„ÅÆ„ÄÄÊæÑ„ÅøÊ∏°„Çä„Åü„ÇãÈùí„Åï„Åã„Å™„ÄÄÂøÉ„Åæ„ÅßÊæÑ„ÇÄÊÄù„ÅÑ„Åô„Çã„Å™„Çä",
                    translation: "Que azul l√≠mpido tem o c√©u de inverno! Sinto como se At√© meu cora√ß√£o Se tornasse transparente.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Ramos Nus",
                    original: "ÂÜ¨Êú®Á´ã„ÄÄËëâ„ÇíËêΩ„Å®„Åó„Åü„ÇãÊûùË¶ã„Çå„Å∞„ÄÄÊò•„ÇíÂæÖ„Å§ÂäõÊÑü„Åò„Çâ„Çå„Å¨",
                    translation: "As √°rvores de inverno... Vendo os galhos que perderam as folhas, Sinto a for√ßa Que aguarda a primavera.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },

                // JULHO - Inverno
                {
                    title: "O Toque do Braseiro",
                    original: "ÁÄ¨Êà∏ÁÅ´Èâ¢„ÅÆ„Åó„Åü„Åó„ÅÑËß¶ÊÑü„ÄÄ„Éí„Ç∑„Éí„Ç∑„Å®È≥¥„Çã„ÄÄÁÇ≠ÁÅ´„ÅÆÈü≥",
                    translation: "A textura √≠ntima e familiar do braseiro de cer√¢mica... E o som do carv√£o que canta ‚Äî 'hishi-hishi' ‚Äî Num estalar tenso e abafado.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Calor do Fogo",
                    original: "ÁÇâ„ÅÆÁÅ´„ÅÆ„ÄÄÊ∏©„ÇÇ„ÇäÂ¨â„Åó„ÅçÂÜ¨„ÅÆÂ§ú„ÄÄÂÆ∂ÊóèÂõ≤„Åø„Å¶ÂøÉÂíå„ÇÄ„Å™„Çä",
                    translation: "Que alegria o calor do fogo na lareira Numa noite de inverno! A fam√≠lia se re√∫ne E os cora√ß√µes se harmonizam.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Lua G√©lida",
                    original: "ÂØíÊúà„ÅÆ„ÄÄÂÜ¥„ÅàÊ∏°„Çä„Åü„ÇãÂ§ú„ÅÆÁ©∫„ÄÄÂáç„ÇãÊÄù„ÅÑ„ÅßÁú∫„ÇÅ„Å¶„Åä„Çä„Å¨",
                    translation: "A lua fria brilha intensamente No c√©u noturno... Com sentimento de congelamento, Fico contemplando.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Vento Cortante",
                    original: "Êú®ÊûØ„Çâ„Åó„ÅÆ„ÄÄÂêπ„ÅèÈü≥ËÅû„Åë„Å∞Ë∫´„Å´Ê≤Å„Åø„Å¶„ÄÄÂÜ¨„ÅÆÂé≥„Åó„ÅïÊîπ„ÇÅ„Å¶Áü•„Çã",
                    translation: "Ouvindo o som do vento g√©lido soprar, Sinto penetrar at√© os ossos E conhe√ßo novamente A severidade do inverno.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Neve Silenciosa",
                    original: "Èôç„ÇãÈõ™„ÅÆ„ÄÄÈùô„Åë„Åï„ÅÆ‰∏≠„Å´Ë∫´„ÇíÁΩÆ„Åë„Å∞„ÄÄÂøÉ„ÇÇÈùô„Åæ„ÇäÂÆâ„Çâ„ÅéÂæó„Åü„Çä",
                    translation: "Colocando-me no sil√™ncio Da neve que cai, Meu cora√ß√£o tamb√©m se acalma E encontro paz.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },

                // AGOSTO - Inverno
                {
                    title: "Folhas na Geada",
                    original: "‰∫å„Å§‰∏â„Å§„ÄÄ„ÇÇ„Åø„Å¢„ÅÆ„Å°„ÇäËëâÊùæ„ÅÆËëâ„Å´„ÄÄ„Åã„Åã„Çã„ÅåË¶ã„ÇÜ„ÇãÈúúÁôΩ„ÅçÊúù",
                    translation: "Duas, tr√™s folhas vermelhas ca√≠das... ficaram presas nos galhos do pinheiro. Vejo-as brilhando nesta manh√£ branca de geada.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Pinheiro Verde",
                    original: "Â∏∏Á∑ë„ÅÆ„ÄÄÊùæ„ÅÆÁ∑ë„ÇÇÂÜ¨„ÅÆÊúù„ÄÄÈúú„Å´Ë¶Ü„Çè„ÇåÁôΩ„ÅèËºù„Åè",
                    translation: "At√© o verde sempre-vivo do pinheiro Numa manh√£ de inverno √â coberto pela geada E brilha em branco.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Orvalho Gelado",
                    original: "ÂÜ¨„ÅÆÊúù„ÄÄËçâËëâ„Å´Âáç„ÇãÈú≤Ë¶ã„Çå„Å∞„ÄÄËá™ÁÑ∂„ÅÆÂé≥„Åó„ÅïÁæé„Åó„Åç„Åã„Å™",
                    translation: "Manh√£ de inverno... Vendo o orvalho congelado nas folhas da grama, A severidade da natureza √â bela!",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Quietude Invernal",
                    original: "ÂÜ¨„ÅÆÂ§ú„ÅÆ„ÄÄÈùôÂØÇÊ∑±„ÅèÂøÉÊæÑ„ÇÄ„ÄÄ„Åì„ÅÆÈùô„Åë„Åï„Å´Ë∫´„ÇíÂßî„Å≠„Åü„Çä",
                    translation: "A noite de inverno... O sil√™ncio √© profundo e o cora√ß√£o se purifica. A este sil√™ncio Entrego-me completamente.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },
                {
                    title: "Sol Fraco",
                    original: "ÂÜ¨Êó•Âíå„ÄÄÂº±„ÅçÊó•Â∑Æ„Åó„ÇÇÊúâÈõ£„Åè„ÄÄÊöñ„ÇíÊ±Ç„ÇÅ„ÇãÂøÉÊ∫Ä„Åü„Åï„Çã",
                    translation: "Dia de bom tempo no inverno... At√© os fracos raios de sol s√£o gratos E satisfazem o cora√ß√£o Que busca calor.",
                    kigo: "Inverno",
                    meses: [6, 7, 8]
                },

                // SETEMBRO - Primavera
                {
                    title: "A Primavera Interior",
                    original: "Êò•„ÅØÂÖà„Å•„ÄÄ‰∫∫„ÅÆÂøÉ„Å´Á´ã„Å°„Åù„ÇÄ„Åã„ÄÄÊò®Êó•„Å®Âêå„ÅòÂØíÈ¢®„Åµ„Åë„Å©„ÇÇ",
                    translation: "A Primavera, por acaso, come√ßa primeiro dentro do cora√ß√£o humano? Pergunto isso porque, l√° fora, O mesmo vento g√©lido de ontem continua a soprar.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Primeiros Brotos",
                    original: "Êò•„ÇÅ„ÅÑ„Å¶„ÄÄÂ∞è„Åï„Å™ËäΩÂêπ„ÅçË¶ã„Å§„Åë„Åü„Çä„ÄÄÂ§ßÂú∞„ÅÆÂëΩÁõÆË¶ö„ÇÅ„ÇãÊôÇ„Çí",
                    translation: "Cheira a primavera... Encontrei pequenos brotos! √â o momento em que A vida da terra desperta.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Ar Renovado",
                    original: "Êò•„ÅÆÈ¢®„ÄÄÂÑ™„Åó„ÅèÂêπ„Åç„Å¶ÂøÉÂú∞„Çà„Åó„ÄÄÊñ∞„Åó„ÅçÂ≠£ÁØÄ„ÅÆË®™„ÇåÊÑü„Åò„Å¨",
                    translation: "O vento da primavera sopra gentilmente e agradavelmente... Sinto a chegada Da nova esta√ß√£o.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Esperan√ßa Verde",
                    original: "Ëã•Ëçâ„ÅÆ„ÄÄËêå„ÅàÂá∫„Å•„ÇãÈáéËæ∫„ÇíÁú∫„ÇÄ„Çå„Å∞„ÄÄÂ∏åÊúõ„Å´Ê∫Ä„Å°„Åü„ÇãÊÄù„ÅÑ„Åô„Çã„Å™„Çä",
                    translation: "Contemplando os campos onde A grama jovem brota, Sinto-me Cheio de esperan√ßa.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "C√©u Clareando",
                    original: "Êò•„ÅÆÁ©∫„ÄÄÈúû„Åü„Å™„Å≥„ÅçÁ©è„ÇÑ„Åã„Å´„ÄÄÂøÉ„ÇÇËªΩ„Åè„Å™„Çä„ÇÜ„Åè„ÇíÁü•„Çã",
                    translation: "O c√©u da primavera... A bruma paira suavemente E sei que Meu cora√ß√£o tamb√©m se torna leve.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },

                // OUTUBRO - Primavera
                {
                    title: "Chuva e Musgo",
                    original: "Èõ®„ÅØ„Çå„Å¶„ÄÄÈú≤„ÇÇ„Åó„Å®„Å©„ÅÆÁØÅ„ÅÆ„ÄÄ‰∏ã„Åã„ÅíÈùí„ÅèËãî„ÅÆËä±Âí≤„Åè",
                    translation: "A chuva cessou. No bambuzal ainda denso de orvalho, Sob a sombra fresca e √∫mida, O musgo floresce em verde profundo.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Riacho Cantando",
                    original: "Êò•„ÅÆÊ∞¥„ÄÄ„Åõ„Åõ„Çâ„Åé„ÅÆÈü≥ÂøÉÂú∞„Çà„Åè„ÄÄËÄ≥„ÇíÊæÑ„Åæ„Åõ„Å∞ÂøÉÊ¥ó„Çè„Çã",
                    translation: "A √°gua da primavera... O som do riacho murmurando √© agrad√°vel. Agu√ßando os ouvidos, Meu cora√ß√£o √© lavado.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Verde Ressurgindo",
                    original: "Êú®„ÄÖ„ÅÆËäΩ„ÅÆ„ÄÄÂêπ„ÅçÂá∫„ÅôÊßò„Å´Êò•„ÇíË¶ã„Å¶„ÄÄÁîüÂëΩ„ÅÆÂäõÊÑü„ÅòÂÖ•„Çä„Å¨",
                    translation: "Vendo a primavera Nos brotos que explodem das √°rvores, Sinto profundamente O poder da vida.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Borboletas Dan√ßantes",
                    original: "Ëù∂„ÄÖ„ÅÆ„ÄÄËàû„ÅÑÈ£õ„Å∂Êò•„ÅÆÂçàÂæå„ÅÆÂ∫≠„ÄÄ„ÅÆ„Å©„Åã„Å™„ÇãÊôÇ„Å´ÂøÉÂíå„ÇÄ„Å™„Çä",
                    translation: "Borboletas voam dan√ßando No jardim numa tarde de primavera... Neste tempo tranquilo, Meu cora√ß√£o se harmoniza.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Manh√£ Luminosa",
                    original: "Êò•„ÅÆÊúù„ÄÄÂÖâ„ÇäÊ∫¢„Çã„ÇãÁ™ìËæ∫„Å´„Å¶„ÄÄÊñ∞„Åó„ÅçÊó•„ÅÆÂñú„Å≥ÊÑü„Åö",
                    translation: "Manh√£ de primavera... √Ä janela transbordante de luz, Sinto a alegria Do novo dia.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },

                // NOVEMBRO - Primavera
                {
                    title: "A Montanha de Cerejeiras",
                    original: "„ÇÄ„Çâ„Åï„Åç„ÅÆ„ÄÄÈúû„ÅÆÂ••„Å´„Å©„Çì„Çà„Çä„Å®„ÄÄÈôΩ„ÅÜ„Åë„Å¶Ê°ú„ÅÆÂ±±„Åü„Åü„Åö„Åæ„ÅÜ",
                    translation: "No fundo da bruma purp√∫rea... Banhada por uma luz difusa e pesada, A montanha coberta de cerejeiras repousa im√≥vel.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Flores Desabrochando",
                    original: "Êò•Ê∑±„Åè„ÄÄËä±„ÄÖÂí≤„ÅçË™á„ÇãÂ∫≠Ë¶ã„Çå„Å∞„ÄÄËá™ÁÑ∂„ÅÆÊÅµ„ÅøÊÑüË¨ù„Åõ„Åö„Åä„Çå„Åö",
                    translation: "Primavera profunda... Vendo o jardim onde as flores desabrocham orgulhosas, N√£o posso deixar de Agradecer as b√™n√ß√£os da natureza.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Brisa Floral",
                    original: "Ëä±„ÅÆÈ¶ô„ÅÆ„ÄÄÊºÇ„ÅÜÊò•„ÅÆÂ§ïÊöÆ„Çå„Å´„ÄÄÂøÉ„ÇÇËèØ„ÇÑ„ÅêÊÄù„ÅÑ„Åô„Çã„Åã„Å™",
                    translation: "No entardecer de primavera onde O perfume das flores fluor a... Sinto como se Meu cora√ß√£o tamb√©m florescesse.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "P√°ssaros Cantando",
                    original: "Â∞èÈ≥•„Çâ„ÅÆ„ÄÄ„Åï„Åà„Åö„ÇäËÅû„Åì„ÇÜÊò•„ÅÆÊúù„ÄÄÂøÉÂºæ„Åø„Å¶‰∏ÄÊó•Âßã„Åæ„Çã",
                    translation: "Ou√ßo o chilrear dos passarinhos Numa manh√£ de primavera... Meu cora√ß√£o salta E o dia come√ßa.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },
                {
                    title: "Verde Intenso",
                    original: "Êñ∞Á∑ë„ÅÆ„ÄÄÁú©„Åó„ÅçÁ®ã„Å´ÂÖâ„Çä„Åü„Çã„ÄÄÊú®„ÄÖ„ÇíË¶ã‰∏ä„Åí„Å¶Âäõ„ÇÇ„Çâ„ÅÑ„Å¨",
                    translation: "O verde fresco brilha t√£o intensamente que ofusca... Olhando para as √°rvores, Recebo for√ßa.",
                    kigo: "Primavera",
                    meses: [9, 10, 11]
                },

                // DEZEMBRO - Ver√£o
                {
                    title: "O Crescimento do Povo",
                    original: "Êó•„ÅÆÂÖâ„ÄÄÊúà„ÅÆÊÅµ„Åø„Å´„Åô„Åè„Åô„Åè„Å®„ÄÄ„Åü„Åø„Åè„Åï„ÅÆ„Å≥„Çã„Å®„Åç„Åû„Åæ„Åü„Çã„Çã",
                    translation: "Sob a luz do Sol, E a gra√ßa da Lua, Aguardo o tempo em que o povo, como a relva, Crescer√° vigoroso e pr√≥spero.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "C√©u Azul",
                    original: "Â§èÁ©∫„ÅÆ„ÄÄÈùí„ÅïË¶ã‰∏ä„Åí„Å¶ÂøÉÊô¥„Çå„ÄÄ„Åì„ÅÆÊó•„ÅÆÂñú„Å≥ËÉ∏„Å´Âàª„Åæ„Çã",
                    translation: "Olhando o azul do c√©u de ver√£o, meu cora√ß√£o se abre... A alegria deste dia √â gravada em meu peito.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "For√ßa Vital",
                    original: "Â§èËçâ„ÅÆ„ÄÄÁîü„ÅÑËåÇ„ÇãÈáéËæ∫„ÅÆÂäõÂº∑„Åï„ÄÄË¶ã„Çã„ÇÇÈ†º„ÇÇ„ÅóÂøÉË∫ç„Çâ„Åô",
                    translation: "A for√ßa das ervas de ver√£o crescendo densamente nos campos... √â confi√°vel de ver E faz meu cora√ß√£o saltar.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Dia Radiante",
                    original: "Â§è„ÅÆÊó•„ÅÆ„ÄÄÂÖâ„ÇäÊ∫Ä„Å°„Åü„ÇãÂçàÂæå„ÅÆÂ∫≠„ÄÄÁîüÂëΩÊ∫¢„Çã„ÇãÊßòÁæé„Åó„Åç",
                    translation: "Jardim da tarde cheio Da luz do dia de ver√£o... Bela √© a apar√™ncia Transbordante de vida.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                },
                {
                    title: "Energia do Sol",
                    original: "Â§™ÈôΩ„ÅÆ„ÄÄÊÅµ„ÅøÂèó„Åë„Åü„ÇãÂ§ßÂú∞Ë¶ã„Å¶„ÄÄÊÑüË¨ù„ÅÆÊÄù„ÅÑÊñ∞„Åü„Å´„Åô„Çã„Å™„Çä",
                    translation: "Vendo a terra recebendo As b√™n√ß√£os do sol, Renovo os sentimentos De gratid√£o.",
                    kigo: "Ver√£o",
                    meses: [1, 2, 12]
                }
            ]
        };

        const mesesPt = [
            'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ];

        const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

        const feriadosBrasileiros = {
            0: [
                { dia: 1, nome: 'Ano Novo' },
                { dia: 25, nome: 'Anivers√°rio de SP' }
            ],
            3: [{ dia: 21, nome: 'Tiradentes' }],
            4: [{ dia: 1, nome: 'Dia do Trabalho' }],
            6: [{ dia: 9, nome: 'Revolu√ß√£o Constitucionalista' }],
            8: [{ dia: 7, nome: 'Independ√™ncia do Brasil' }],
            9: [{ dia: 12, nome: 'Nossa Senhora Aparecida' }],
            10: [
                { dia: 2, nome: 'Finados' },
                { dia: 15, nome: 'Proclama√ß√£o da Rep√∫blica' },
                { dia: 20, nome: 'Consci√™ncia Negra' }
            ],
            11: [{ dia: 25, nome: 'Natal' }]
        };

        // Inicializa√ß√£o
        document.getElementById('mesSelect').value = state.mes;
        document.getElementById('anoInput').value = state.ano;

        function carregarJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const json = JSON.parse(e.target.result);

                    // Aceita diferentes formatos de JSON
                    let poesias = [];
                    if (json.calendario) {
                        // Formato do JSON que criamos (brasileiro)
                        poesias = json.calendario.map(item => ({
                            title: item.poesia.titulo,
                            original: item.poesia.original,
                            translation: item.poesia.traducao,
                            leitura: item.poesia.leitura,
                            kigo: item.estacao_brasil,
                            month: item.mes // mes em portugu√™s (1-12)
                        }));
                    } else if (Array.isArray(json)) {
                        poesias = json;
                    } else if (json.poesias || json.poems) {
                        poesias = json.poesias || json.poems;
                    }

                    if (poesias.length > 0) {
                        state.todasPoesias = poesias;
                        state.poesiaSelecionada = 0;
                        state.temaFiltro = 'Todos';

                        atualizarSelects();
                        atualizarCalendario();

                        document.getElementById('json-status').textContent = `‚úÖ ${poesias.length} poesias carregadas`;
                        alert(`‚úÖ ${poesias.length} poesias carregadas com sucesso!`);
                    } else {
                        alert('‚ùå Formato de JSON inv√°lido.');
                    }
                } catch (error) {
                    alert('‚ùå Erro ao ler o arquivo JSON: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function randomizarPoesia() {
            // Filtra poesias que s√£o apropriadas para o m√™s atual
            const mesAtual = state.mes + 1;
            const poesiasDoMes = state.todasPoesias.filter(p => p.meses && p.meses.includes(mesAtual));

            if (poesiasDoMes.length === 0) {
                alert('N√£o h√° poesias dispon√≠veis para este m√™s.');
                return;
            }

            // Escolhe uma poesia aleat√≥ria
            const indiceAleatorio = Math.floor(Math.random() * poesiasDoMes.length);
            const poesiaEscolhida = poesiasDoMes[indiceAleatorio];

            // Encontra o √≠ndice real no array completo
            const indiceReal = state.todasPoesias.indexOf(poesiaEscolhida);

            // Salva na mem√≥ria
            state.poesiasEscolhidas[state.mes] = indiceReal;
            state.poesiaSelecionada = indiceReal;

            // Atualiza dependendo da vis√£o
            if (state.modoVisualizacao === 'grade') {
                renderizarAnoView();
            } else {
                atualizarCalendario();
            }
        }

        function randomizarAnoCompleto() {
            // Nota: N√£o usa localStorage (compatibilidade com modo privado)

            const novasEscolhas = [];
            const indicesUsados = new Set(); // Para garantir unicidade no ano

            // Para cada m√™s (1-12)
            for (let mes = 1; mes <= 12; mes++) {
                const poesiasDoMes = state.todasPoesias.filter(p => p.meses && p.meses.includes(mes));

                if (poesiasDoMes.length === 0) {
                    novasEscolhas.push(null);
                    continue;
                }

                // Tenta filtrar poesias que ainda N√ÉO foram usadas neste ano
                let pool = poesiasDoMes.filter((p) => {
                    const indiceReal = state.todasPoesias.indexOf(p);
                    return !indicesUsados.has(indiceReal);
                });

                // Se n√£o h√° op√ß√µes √∫nicas (esgotou o estoque para esta esta√ß√£o), 
                // usa todas as dispon√≠veis do m√™s (permite repeti√ß√£o como fallback)
                if (pool.length === 0) {
                    pool = poesiasDoMes;
                }

                // Escolhe aleat√≥ria
                const indiceAleatorio = Math.floor(Math.random() * pool.length);
                const poesiaEscolhida = pool[indiceAleatorio];
                const indiceReal = state.todasPoesias.indexOf(poesiaEscolhida);

                indicesUsados.add(indiceReal);
                novasEscolhas.push(indiceReal);
            }

            // Salva as escolhas deste ano (apenas em mem√≥ria)
            state.poesiasEscolhidas = novasEscolhas;

            // Atualiza o calend√°rio para o m√™s atual
            state.poesiaSelecionada = novasEscolhas[state.mes];
            const poesiaAtual = state.todasPoesias[novasEscolhas[state.mes]];
            const fasesLua = obterDiasFasesLua(state.mes, state.ano);
            const dias = gerarCalendario(state.mes, state.ano);
            renderizarCalendario(poesiaAtual, fasesLua, dias);

            // Se estiver na vis√£o de grade, atualiza ela tamb√©m
            if (state.modoVisualizacao === 'grade') {
                renderizarAnoView();
            }

            alert(`‚úÖ Ano ${state.ano} randomizado com sucesso!\n\n${novasEscolhas.filter(p => p !== null).length} poesias escolhidas.\n\nPoesias √∫nicas garantidas para o ano!`);
        }

        function atualizarCalendario() {
            state.mes = parseInt(document.getElementById('mesSelect').value);
            state.ano = parseInt(document.getElementById('anoInput').value);

            const poesiasFiltradas = state.temaFiltro === 'Todos'
                ? state.todasPoesias
                : state.todasPoesias.filter(p => p.kigo && p.kigo.includes(state.temaFiltro));

            // Busca a poesia espec√≠fica para o m√™s atual (mes + 1 porque √© 0-indexed)
            const mesAtual = state.mes + 1;
            let poesiaDoMesIndex = poesiasFiltradas.findIndex(p => p.meses && p.meses.includes(mesAtual));

            // Se n√£o houver poesia espec√≠fica selecionada, escolhe a primeira do m√™s 
            if (poesiaDoMesIndex === -1) {
                // Tenta encontrar qualquer poesia do m√™s na lista completa
                poesiaDoMesIndex = state.todasPoesias.findIndex(p => p.meses && p.meses.includes(mesAtual));
                if (poesiaDoMesIndex !== -1) {
                    state.poesiaSelecionada = poesiaDoMesIndex;
                }
            } else {
                state.poesiaSelecionada = poesiaDoMesIndex;
            }

            const poesiaAtual = state.todasPoesias[state.poesiaSelecionada] || poesiasFiltradas[0];
            const fasesLua = obterDiasFasesLua(state.mes, state.ano);
            const dias = gerarCalendario(state.mes, state.ano);

            renderizarCalendario(poesiaAtual, fasesLua, dias);
        }

        function gerarCalendario(mes, ano) {
            const primeiroDia = new Date(ano, mes, 1).getDay();
            const ultimoDia = new Date(ano, mes + 1, 0).getDate();

            const dias = [];

            for (let i = 0; i < primeiroDia; i++) {
                dias.push({ dia: '', mesAtual: false });
            }

            for (let i = 1; i <= ultimoDia; i++) {
                dias.push({ dia: i, mesAtual: true });
            }

            const diasRestantes = 42 - dias.length;
            for (let i = 0; i < diasRestantes; i++) {
                dias.push({ dia: '', mesAtual: false });
            }

            return dias;
        }

        function calcularPascoa(ano) {
            const a = ano % 19;
            const b = Math.floor(ano / 100);
            const c = ano % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const mesPascoa = Math.floor((h + l - 7 * m + 114) / 31);
            const diaPascoa = ((h + l - 7 * m + 114) % 31) + 1;

            return new Date(ano, mesPascoa - 1, diaPascoa);
        }

        function ehFeriado(dia, mes, ano) {
            // For√ßa bruta para garantir o Natal
            if (mes === 11 && dia === 25) return 'Natal';

            const feriadoFixo = feriadosBrasileiros[mes]?.find(f => f.dia === dia);
            if (feriadoFixo) return feriadoFixo.nome;

            const pascoa = calcularPascoa(ano);

            const carnaval = new Date(pascoa);
            carnaval.setDate(pascoa.getDate() - 47);
            if (mes === carnaval.getMonth() && dia === carnaval.getDate()) return 'Carnaval';

            const sextaSanta = new Date(pascoa);
            sextaSanta.setDate(pascoa.getDate() - 2);
            if (mes === sextaSanta.getMonth() && dia === sextaSanta.getDate()) return 'Sexta-feira Santa';

            const corpus = new Date(pascoa);
            corpus.setDate(pascoa.getDate() + 60);
            if (mes === corpus.getMonth() && dia === corpus.getDate()) return 'Corpus Christi';

            return null;
        }

        function obterDiasFasesLua(mes, ano) {
            const ultimoDia = new Date(ano, mes + 1, 0).getDate();
            const fases = { nova: null, crescente: null, cheia: null, minguante: null };

            for (let dia = 1; dia <= ultimoDia; dia++) {
                const data = new Date(ano, mes, dia);
                const conhecidaLuaNova = new Date(2000, 0, 6);
                const cicleLunar = 29.53058867;
                const diasDesde = (data - conhecidaLuaNova) / (1000 * 60 * 60 * 24);
                const fase = ((diasDesde % cicleLunar) + cicleLunar) % cicleLunar;

                if (fase < 1.5 && fases.nova === null) fases.nova = dia;
                else if (fase >= 6.5 && fase < 8.5 && fases.crescente === null) fases.crescente = dia;
                else if (fase >= 13.5 && fase < 15.5 && fases.cheia === null) fases.cheia = dia;
                else if (fase >= 20.5 && fase < 22.5 && fases.minguante === null) fases.minguante = dia;
            }

            return fases;
        }

        function renderizarCalendario(poesia, fasesLua, dias) {
            const calendario = document.getElementById('calendario');

            let diasHTML = '';
            dias.forEach((d, i) => {
                const nomeFeriado = d.mesAtual && d.dia ? ehFeriado(d.dia, state.mes, state.ano) : null;
                const isDomingo = i % 7 === 0;
                const isSabado = i % 7 === 6;
                const rowIndex = Math.floor(i / 7);
                const colIndex = i % 7;

                const borderBottom = rowIndex < 5 ? 'border-bottom: 1px solid #e5e5e5;' : '';
                const borderRight = colIndex < 6 ? 'border-right: 1px solid #e5e5e5;' : '';

                diasHTML += `
          <div class="day-cell ${d.mesAtual ? 'current-month' : 'other-month'}" 
               style="${borderBottom} ${borderRight}">
            ${d.dia ? `
              <div class="day-number ${nomeFeriado ? 'holiday' : ''} ${isDomingo ? 'sunday' : ''} ${isSabado ? 'saturday' : ''}"
                   style="color: ${nomeFeriado || isDomingo ? '#dc2626' : (isSabado ? '#2563eb' : (d.mesAtual ? '#1a1a1a' : '#bbb'))};">
                ${d.dia}
              </div>
              ${nomeFeriado ? `<div class="holiday-name">${nomeFeriado}</div>` : ''}
            ` : ''}
          </div>
        `;
            });

            calendario.innerHTML = `
        <div class="hero-section">
          <div style="font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: #999; margin-bottom: 40px; font-weight: 400;">Yama to Mizu</div>
          <div class="poesia-original">${poesia.original}</div>
          <div class="poesia-traducao">${poesia.translation}</div>
          <div style="font-size: 12px; color: #999; margin-top: 35px; font-weight: 300; letter-spacing: 1px;">‚Äî Meishu-sama</div>
        </div>
        
        <div class="calendar-section">
          <div class="calendar-header">
            <div class="month-title">${mesesPt[state.mes]}</div>
            
            <div class="moon-phases">
              <div class="moon-phases-title">Fases da lua</div>
              <div class="moon-phases-row">
                <span class="moon-icon">‚óê</span>
                <span>${fasesLua.crescente || '-'}</span>
                <span class="moon-icon" style="margin-left: 4px;">‚óã</span>
                <span>${fasesLua.cheia || '-'}</span>
                <span class="moon-icon" style="margin-left: 4px;">‚óë</span>
                <span>${fasesLua.minguante || '-'}</span>
                <span class="moon-icon" style="margin-left: 4px;">‚óè</span>
                <span>${fasesLua.nova || '-'}</span>
              </div>
            </div>
          </div>
          
          <div class="calendar-grid">
            ${diasSemana.map((dia, i) => `
              <div class="day-header" style="${i < 6 ? 'border-right: 1px solid #e5e5e5;' : ''} color: ${i === 0 ? '#dc2626' : (i === 6 ? '#2563eb' : '#737373')};">
                ${dia}
              </div>
            `).join('')}
            
            ${diasHTML}
          </div>
          
          <div class="year-footer">${state.ano}</div>
        </div>
      `;
        }

        // --- L√ìGICA DA VIS√ÉO ANUAL INTERATIVA ---

        state.modoVisualizacao = 'unico'; // 'unico' ou 'grade'

        function alternarVisao() {
            const calendarioDiv = document.getElementById('calendario');
            const visaoAnoDiv = document.getElementById('visaoAno');
            const btn = document.querySelector('button[onclick="alternarVisao()"]');

            if (state.modoVisualizacao === 'unico') {
                state.modoVisualizacao = 'grade';
                calendarioDiv.style.display = 'none';
                visaoAnoDiv.style.display = 'grid';
                btn.innerHTML = 'üëÅÔ∏è Ver M√™s √önico';
                renderizarAnoView();
            } else {
                state.modoVisualizacao = 'unico';
                calendarioDiv.style.display = 'block';
                visaoAnoDiv.style.display = 'none';
                btn.innerHTML = 'üëÅÔ∏è Ver Grade Anual';
                atualizarCalendario(); // Volta para o m√™s selecionado
            }
        }

        function selecionarMes(mesIndex) {
            state.mes = mesIndex;
            document.getElementById('mesSelect').value = mesIndex;

            // Re-renderizar grade para atualizar sele√ß√£o visual
            renderizarAnoView();
        }

        function renderizarAnoView() {
            const visaoAnoDiv = document.getElementById('visaoAno');
            if (state.modoVisualizacao !== 'grade') return;

            let htmlFull = '';

            for (let m = 0; m < 12; m++) {
                // Obter poesia
                let poesiaDoMes;
                const indicePoesiaEscolhida = state.poesiasEscolhidas[m];

                if (indicePoesiaEscolhida !== null) {
                    poesiaDoMes = state.todasPoesias[indicePoesiaEscolhida];
                } else {
                    // Se n√£o tiver escolhida, pega padr√£o da √©poca
                    poesiaDoMes = state.todasPoesias.find(p => p.meses.includes(m + 1)) || state.todasPoesias[0];
                }

                const fasesLuaMes = obterDiasFasesLua(m, state.ano);
                const diasMes = gerarCalendario(m, state.ano);
                const isSelecionado = (m === state.mes);

                // Gerar grid de dias do m√™s
                let diasHTML = '';
                diasMes.forEach((d, i) => {
                    const nomeFeriado = d.mesAtual && d.dia ? ehFeriado(d.dia, m, state.ano) : null;
                    const isDomingo = i % 7 === 0;
                    const isSabado = i % 7 === 6;
                    const rowIndex = Math.floor(i / 7);
                    const colIndex = i % 7;
                    const borderBottom = rowIndex < 5 ? 'border-bottom: 1px solid #e5e5e5;' : '';
                    const borderRight = colIndex < 6 ? 'border-right: 1px solid #e5e5e5;' : '';

                    diasHTML += `
                      <div class="day-cell ${d.mesAtual ? 'current-month' : 'other-month'}" 
                           style="${borderBottom} ${borderRight}">
                        ${d.dia ? `<div class="day-number ${nomeFeriado ? 'holiday' : ''} ${isDomingo ? 'sunday' : ''} ${isSabado ? 'saturday' : ''}"
                               style="color: ${nomeFeriado || isDomingo ? '#dc2626' : (isSabado ? '#2563eb' : (d.mesAtual ? '#1a1a1a' : '#bbb'))};">
                            ${d.dia}
                          </div>` : ''}
                      </div>`;
                });

                // HTML do Card Miniatura
                htmlFull += `
                <div class="card-miniatura ${isSelecionado ? 'selecionado' : ''}" onclick="selecionarMes(${m})">
                    <div class="card-miniatura-content">
                         <div class="hero-section">
                          <div style="font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: #999; margin-bottom: 40px; font-weight: 400;">Yama to Mizu</div>
                          <div class="poesia-original">${poesiaDoMes.original}</div>
                          <div class="poesia-traducao">${poesiaDoMes.translation}</div>
                        </div>
                        
                        <div class="calendar-section">
                          <div class="calendar-header">
                            <div class="month-title">${mesesPt[m]}</div>
                            <div class="moon-phases">
                              <div class="moon-phases-row">
                                <span class="moon-icon">‚óê</span>
                                <span>${fasesLuaMes.crescente || '-'}</span>
                                <span class="moon-icon" style="margin-left: 4px;">‚óã</span>
                                <span>${fasesLuaMes.cheia || '-'}</span>
                              </div>
                            </div>
                          </div>
                          <div class="calendar-grid">
                            ${diasSemana.map((dia, i) => `
                              <div class="day-header" style="${i < 6 ? 'border-right: 1px solid #e5e5e5;' : ''}; color: ${i === 0 ? '#dc2626' : (i === 6 ? '#2563eb' : '#737373')};">
                                ${dia}
                              </div>
                            `).join('')}
                            ${diasHTML}
                          </div>
                          <div class="year-footer">${state.ano}</div>
                        </div>
                    </div>
                </div>`;
            }

            visaoAnoDiv.innerHTML = htmlFull;
        }

        // --- FIM L√ìGICA VIS√ÉO ANUAL ---

        function imprimirMes() {
            const tamanhoPapel = document.getElementById('tamanhoPapel').value;

            // Adiciona classe ao body baseado no tamanho selecionado
            document.body.classList.add(`print-${tamanhoPapel.toLowerCase()}`);

            // Aguarda um pouco para aplicar o estilo
            setTimeout(() => {
                window.print();

                // Remove a classe ap√≥s imprimir
                window.onafterprint = () => {
                    document.body.classList.remove(`print-${tamanhoPapel.toLowerCase()}`);
                };
            }, 100);
        }

        function imprimirAnoCompleto() {
            const tamanhoPapel = document.getElementById('tamanhoPapel').value;
            const janelaImpressao = window.open('', '', 'height=1200,width=1400');

            let htmlCompleto = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Calend√°rio ${state.ano} - Ano Completo</title>
          <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400&display=swap" rel="stylesheet">
          <style>
            ${document.querySelector('style').textContent}
            .pagina { page-break-after: always; }
            .pagina:last-child { page-break-after: auto; }
          </style>
        </head>
        <body class="print-${tamanhoPapel.toLowerCase()}">
      `;

            for (let m = 0; m < 12; m++) {
                // Obter poesia (usa l√≥gica de escolhidas se houver)
                let poesiaDoMes;
                const indicePoesiaEscolhida = state.poesiasEscolhidas[m];

                if (indicePoesiaEscolhida !== null) {
                    poesiaDoMes = state.todasPoesias[indicePoesiaEscolhida];
                } else {
                    poesiaDoMes = state.todasPoesias.find(p => p.meses.includes(m + 1)) || state.todasPoesias[0];
                }

                const fasesLuaMes = obterDiasFasesLua(m, state.ano);
                const diasMes = gerarCalendario(m, state.ano);

                let diasHTML = '';
                diasMes.forEach((d, i) => {
                    const nomeFeriado = d.mesAtual && d.dia ? ehFeriado(d.dia, m, state.ano) : null;
                    const isDomingo = i % 7 === 0;
                    const isSabado = i % 7 === 6;
                    const rowIndex = Math.floor(i / 7);
                    const colIndex = i % 7;

                    const borderBottom = rowIndex < 5 ? 'border-bottom: 1px solid #e5e5e5;' : '';
                    const borderRight = colIndex < 6 ? 'border-right: 1px solid #e5e5e5;' : '';

                    diasHTML += `
            <div class="day-cell ${d.mesAtual ? 'current-month' : 'other-month'}" 
                 style="${borderBottom} ${borderRight}">
              ${d.dia ? `
                <div class="day-number ${nomeFeriado ? 'holiday' : ''} ${isDomingo ? 'sunday' : ''} ${isSabado ? 'saturday' : ''}"
                     style="color: ${nomeFeriado || isDomingo ? '#dc2626' : (isSabado ? '#2563eb' : (d.mesAtual ? '#1a1a1a' : '#bbb'))};">
                  ${d.dia}
                </div>
                ${nomeFeriado ? `<div class="holiday-name">${nomeFeriado}</div>` : ''}
              ` : ''}
            </div>
          `;
                });

                htmlCompleto += `
          <div class="pagina" id="calendario">
            <div class="hero-section">
              <div style="font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: #999; margin-bottom: 40px; font-weight: 400;">Yama to Mizu</div>
              <div class="poesia-original">${poesiaDoMes.original}</div>
              <div class="poesia-traducao">${poesiaDoMes.translation}</div>
              <div style="font-size: 12px; color: #999; margin-top: 35px; font-weight: 300; letter-spacing: 1px;">‚Äî Meishu-sama</div>
            </div>
            
            <div class="calendar-section">
              <div class="calendar-header">
                <div class="month-title">${mesesPt[m]}</div>
                
                <div class="moon-phases">
                  <div class="moon-phases-title">Fases da lua</div>
                  <div class="moon-phases-row">
                    <span class="moon-icon">‚óê</span>
                    <span>${fasesLuaMes.crescente || '-'}</span>
                    <span class="moon-icon" style="margin-left: 4px;">‚óã</span>
                    <span>${fasesLuaMes.cheia || '-'}</span>
                    <span class="moon-icon" style="margin-left: 4px;">‚óë</span>
                    <span>${fasesLuaMes.minguante || '-'}</span>
                    <span class="moon-icon" style="margin-left: 4px;">‚óè</span>
                    <span>${fasesLuaMes.nova || '-'}</span>
                  </div>
                </div>
              </div>
              
              <div class="calendar-grid">
                ${diasSemana.map((dia, i) => `
                  <div class="day-header" style="${i < 6 ? 'border-right: 1px solid #e5e5e5;' : ''}; color: ${i === 0 ? '#dc2626' : (i === 6 ? '#2563eb' : '#737373')};">
                    ${dia}
                  </div>
                `).join('')}
                
                ${diasHTML}
              </div>
              
              <div class="year-footer">${state.ano}</div>
            </div>
          </div>
        `;
            }

            htmlCompleto += '</body></html>';

            janelaImpressao.document.write(htmlCompleto);
            janelaImpressao.document.close();

            setTimeout(() => {
                janelaImpressao.print();
                janelaImpressao.onafterprint = () => janelaImpressao.close();
            }, 500);
        }

        // Inicializar
        atualizarCalendario();
    </script>
</body>

</html>